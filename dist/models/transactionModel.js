"use strict";var c=Object.defineProperty;var v=Object.getOwnPropertyDescriptor;var g=Object.getOwnPropertyNames;var A=Object.prototype.hasOwnProperty;var w=(e,t)=>{for(var n in t)c(e,n,{get:t[n],enumerable:!0})},x=(e,t,n,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of g(t))!A.call(e,r)&&r!==n&&c(e,r,{get:()=>t[r],enumerable:!(o=v(t,r))||o.enumerable});return e};var _=e=>x(c({},"__esModule",{value:!0}),e);var D={};w(D,{default:()=>a});module.exports=_(D);var l=require("knex");var m=require("dotenv"),s=require("zod");process.env.NODE_ENV==="test"?(0,m.config)({path:".env.test"}):(0,m.config)();var E=s.z.object({NODE_ENV:s.z.enum(["development","production","test"]).default("production"),DATABASE_URL:s.z.string(),PORT:s.z.number().default(3333)}),f=E.safeParse(process.env);if(f.success===!1)throw console.error("\u{1F440} invalid enviroment variable ",f.error.format()),new Error("invalid enviroment variable");var u=f.data;if(!process.env.DATABASE_URL)throw new Error("DATABASE_URL is required");var T={client:"sqlite",connection:{filename:u.DATABASE_URL},useNullAsDefault:!0,migrations:{extension:"ts",directory:"./db/migrations"}},i=(0,l.knex)(T);var p=require("crypto"),a=class{static async getAllTransactions(t){return await i("transactions").where("session_id",t).select()}static async getTransactionsSummary(t){return await i("transactions").where("session_id",t).sum("amount",{as:"amount"}).first()}static async getTransaction(t,n){return await i("transactions").where({session_id:n,id:t}).first()}static async createTransaction(t,n){let{title:o,amount:r,type:d}=t;await i("transactions").insert({id:(0,p.randomUUID)(),title:o,amount:d==="credit"?r:r*-1,session_id:n})}};
